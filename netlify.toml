[build]
  command = "npm install && npx convex deploy --cmd 'npm run build' --cmd-url-env-var-name VITE_CONVEX_URL"
  publish = "dist"

# Redirects for client-side routing with React Router
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# Security Headers
[[headers]]
  for = "/*"
  [headers.values]
    # Prevent XSS attacks
    X-XSS-Protection = "1; mode=block"
    # Prevent MIME type sniffing
    X-Content-Type-Options = "nosniff"
    # Prevent clickjacking (SAMEORIGIN allows Turnstile CAPTCHA iframes)
    X-Frame-Options = "SAMEORIGIN"
    # Referrer policy for privacy
    Referrer-Policy = "strict-origin-when-cross-origin"
    # Permissions policy (restrict features)
    Permissions-Policy = "accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=()"
    # Content Security Policy - Production-ready configuration based on Clerk's official documentation
    # https://clerk.com/docs/security/clerk-csp
    Content-Security-Policy = "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://clerk.carfolio.cc https://*.clerk.accounts.dev https://challenges.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com data:; img-src 'self' data: blob: https://img.clerk.com https://*.backblazeb2.com https://*.convex.cloud https://images.unsplash.com; connect-src 'self' https://clerk.carfolio.cc https://*.clerk.accounts.dev https://*.convex.cloud wss://*.convex.cloud https://*.backblazeb2.com https://api.backblazeb2.com https://challenges.cloudflare.com https://clerk-telemetry.com https://*.sentry.io https://sentry.io; frame-src 'self' https://challenges.cloudflare.com https://clerk.carfolio.cc https://*.clerk.accounts.dev; worker-src 'self' blob:; child-src 'self' blob: https://challenges.cloudflare.com; form-action 'self';"

# Environment variable definitions can be referenced here, but the actual values
# should be set in the Netlify dashboard for security reasons
[context.production]
  environment = { NODE_VERSION = "20" }

[context.deploy-preview]
  environment = { NODE_VERSION = "20" }

