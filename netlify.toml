[build]
  command = "npm install && npx convex deploy --cmd 'npm run build' --cmd-url-env-var-name VITE_CONVEX_URL"
  publish = "dist"

# Redirects for client-side routing with React Router
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# Security Headers
[[headers]]
  for = "/*"
  [headers.values]
    # Prevent XSS attacks
    X-XSS-Protection = "1; mode=block"
    # Prevent MIME type sniffing
    X-Content-Type-Options = "nosniff"
    # Prevent clickjacking
    X-Frame-Options = "DENY"
    # Referrer policy for privacy
    Referrer-Policy = "strict-origin-when-cross-origin"
    # Permissions policy (restrict features)
    Permissions-Policy = "accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=()"
    # Content Security Policy - allows images from Backblaze and Clerk, scripts from self
    # Updated to include Cloudflare Turnstile for Clerk CAPTCHA, Unsplash for avatars, and blob workers
    Content-Security-Policy = "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://clerk.carfolio.cc https://*.clerk.accounts.dev https://challenges.cloudflare.com https://static.cloudflareinsights.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com data:; img-src 'self' data: blob: https://*.backblazeb2.com https://*.clerk.com https://img.clerk.com https://*.convex.cloud https://images.unsplash.com; connect-src 'self' https://*.convex.cloud wss://*.convex.cloud https://clerk.carfolio.cc https://*.clerk.accounts.dev https://*.backblazeb2.com https://api.backblazeb2.com https://challenges.cloudflare.com; frame-src https://*.clerk.accounts.dev https://clerk.carfolio.cc https://challenges.cloudflare.com; worker-src 'self' blob:;"

# Environment variable definitions can be referenced here, but the actual values
# should be set in the Netlify dashboard for security reasons
[context.production]
  environment = { NODE_VERSION = "20" }

[context.deploy-preview]
  environment = { NODE_VERSION = "20" }

